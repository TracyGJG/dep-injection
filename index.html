<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dependency Regestry test harness</title>
  </head>
  <body>
    <script type="module">
      import DEPS_REGISTRY, { getInternalStores } from './dep-injection.js';

      class clsNoArgs {
        getProp() {
          return `singleNoArgs`;
        }
      }

      class clsWithArgs {
        #arg = '';
        constructor(arg) {
          this.#arg = arg;
        }

        getProp() {
          return `singleWithArgs: ${this.#arg}`;
        }
      }

      function fnNoArgs() {
        return {
          getProp() {
            return `fnNoArgs`;
          },
        };
      }

      function fnWithArgs(arg) {
        return {
          getProp() {
            return `fnWithArgs: ${arg}`;
          },
        };
      }

      const DepsRegistry = DEPS_REGISTRY(
        [clsNoArgs],
        [clsWithArgs, ['test']],
        [fnNoArgs],
        [fnWithArgs, ['test']]
      );

      const { DEPS, INSTS } = getInternalStores();

      console.log(DEPS);
      console.log(INSTS);

      {
        const testInst = DepsRegistry.create(clsNoArgs, 'ref1');
        console.log(`clsNoArgs: ${testInst.getProp()}`);
      }

      {
        const testInst = DepsRegistry.create(clsWithArgs);
        console.log(`clsWithArgs: ${testInst.getProp()}`);
      }

      {
        const testInst = DepsRegistry.create(fnNoArgs, 'ref2');
        console.log(`fnNoArgs: ${testInst.getProp()}`);
      }

      {
        const testInst = DepsRegistry.create(fnWithArgs);
        console.log(`fnWithArgs: ${testInst.getProp()}`);
      }

      console.log(DEPS);
      console.log(INSTS);

      DepsRegistry.remove('ref1');
      DepsRegistry.remove('ref2');

      console.log(DEPS);
      console.log(INSTS);

      DepsRegistry.deregister();

      console.log(DEPS);
      console.log(INSTS);
    </script>
  </body>
</html>
